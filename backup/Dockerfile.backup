FROM alpine:3.16

# Install mysql-client, bash and cronie (cron daemon for Alpine)
RUN apk add --no-cache mysql-client bash cronie

# Copy the backup script and cron file into the container
COPY backup.sh /usr/local/bin/backup.sh
COPY backup.cron /etc/cron.d/backup

# Ensure the backup script is executable
RUN chmod +x /usr/local/bin/backup.sh

# Install the cron job
RUN crontab /etc/cron.d/backup

# Create a directory for backups (this should be mounted as a volume in your stack)
RUN mkdir -p /backups

# Run crond in the foreground (with debug level 8 for detailed logs)
CMD ["crond", "-f", "-d", "8"]
